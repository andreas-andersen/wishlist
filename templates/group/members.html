{% extends 'base.html' %}
{% load static %}
{% load tags %}

{% block content %}

    <div class="back">
        <a href="{% url 'my_groups' %}"><i class="fi-rr-angle-double-left"></i></a>
    </div>

    <div class="page-title">
        <div>{{ current_group.name }}</div>
        <div id="burger" class="burger" onclick="dropBurger()">
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <div id="burger-menu-id" class="burger-menu">
                <a href="#invite" class="burger-element">
                    <i class="fi-rr-paper-plane dropdown-icon"></i>Invite user
                </a>
                <a href="#add-member" class="burger-element">
                    <i class="fi-rr-users dropdown-icon"></i>Add member
                </a>
                {% if leader %}
                    <a href="{% url 'manual_assignment' current_group.id %}" class="burger-element">
                        <i class="fi-rr-shuffle dropdown-icon"></i>Shuffle / Assignment
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="list-container">
        <div class="list-title plain-title">
            <div>
                Group members
            </div>
        </div>
        <table class="list">
            <tr class="list-top">
                {% if leader %}
                    <td class="members-list-email">
                        Email
                    </td>
                {% endif %}
                <td class="members-list-name">
                    Name
                </td>
                {% if leader %}
                    <td class="members-list-wish-submitted">
                        List Submitted
                    </td>
                    <td class="members-list-actions">
                    </td>
                {% endif %}
            </tr>

            {% for user in object_list %}
                <tr class="list-entry {% if current_group.leader == user %}list-entry-important{% endif %}">
                    {% if leader %}
                        <td class="members-list-email">
                            {% if user.is_self_responsible %}
                                <a href="" class = "item-title">
                                    {{ user.email }}
                                </a>
                            {% endif %}
                        </td>
                    {% endif %}
                    <td class="members-list-name">
                        {{ user.first_name }} {{ user.last_name }}
                    </td>
                    <td class="members-list-wish-submitted">
                        {% get_wishlist_existence current_group user %}
                    </td>
                    <td class="members-list-wish-actions">
                        {% if user.id != user.id or user.responsible_by == current_user or leader %}
                            <span>
                                {% if current_group.leader == user %}
                                    Group Leader
                                {% else %}
                                    <a href="{% url 'remove_group_member' current_group.id user.id %}"> 
                                        - Remove
                                    </a>
                                {% endif %}
                            </span>
                        {% endif %}
                    </td>
                </tr> 
            {% endfor %}

            <tr class="list-empty-bottom">
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </table>
    </div>

    {% if leader %}
        <a name="invite"></a>
        <table class="list">
            <tr class="list-bottom">
                <form id="invite-user", method="post" action="{% url 'invite_group_member' current_group.id current_user.id %}">
                    {% csrf_token %}
                    <td class="members-list-invite-email">
                        {{ invite_form.email }}
                    </td>
                    <td class="members-list-invite-invite">
                        <a href="#" onclick="document.getElementById('invite-user').submit()">
                            + Invite user
                        </a>
                    </td>
                    <td class="members-list-invite-errors">
                        {% if messages %}
                            {% for message in messages %}
                                {% if 'invite' in message.tags %}
                                    <span>{{ message }}</span>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    </td>
                </form>
            </tr>
        </table>
        {% if invitation %}
            <div class="list-container-2">
                <div class="list-title plain-title">
                    Invited users
                </div>
                <table class="list">
                    <tr class="list-top">
                        <td class="members-list-invited-email">
                            Email
                        </td>
                        <td class="members-list-invited-action">
                        </td>
                    </tr>

                    {% for user in invited_users %}
                        <tr class="list-entry">
                            <td class="members-list-invited-email">
                                {{ user.email }}
                            </td>
                            <td class="members-list-invited-action">
                                <a href="{% url 'uninvite_user' current_group.id user.id %}">
                                    - Uninvite
                                </a>
                            </td>
                        </tr>
                    {% endfor %}

                    <tr class="list-empty-bottom">
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                </table>
            </div>
        {% else %}
        {% endif %}
    {% endif %}

    <hr class="list-page-divider">

    {% if current_user.is_self_responsible %}
        <a name="add-member"></a>
        <div class="noted-list">
            <div class="list-title plain-title">
                <div>
                    Add member
                </div>
            </div>
            <table id="create-member-table" class="list">
                <tr class="list-bottom">
                    <form id="create-member", method="post" 
                        action="{% url 'create_group_member' current_group.id current_user.id %}">
                        {% csrf_token %}
                        {{ create_form.email.as_hidden }}
                        <td class="create-member-first-name">
                            {{ create_form.first_name }}
                        </td>
                        <td class="create-member-last-name">
                            {{ create_form.last_name }}
                        </td>
                        <td class="create-member-actions">
                            <a href="#", onclick="document.getElementById('create-member').submit()">
                                + Add
                            </a>
                        </td>
                    </form>
                </tr>
            </table>
            <div class="noted-list-note-container">
                <span class="noted-list-note">
                    This is for adding members your are responsible for, e.g. your children.
                    Their lists will be avaiable in the my lists and received lists section along with you own.
                </span>
            </div>
        </div> 
    {% endif %}

{% endblock content %}